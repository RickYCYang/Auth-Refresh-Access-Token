<!-- ABOUT THE PROJECT -->

## Refresh Token and Access Token Authentication

This project is an implementation of oAuth `Refresh Token` and `Access Token` authentication with `Role-based` authorization, which focus on client-server authentication process, and did not cover machine to machine authentication.

In addition, the frontend support the persist login feature which would keep the login status and would not ask user to login again when user refreshed the browser until refresh token expired.

The basic concept of `Refresh Token` and `Access Token` authentication flow could refer to [here](https://cloudentity.com/developers/basics/oauth-grant-types/refresh-token-flow/).

Tech stack:

- Frontend: React
- Backend: Express
- Database: MongoDB

Most source code of this project came from [Dave Gray's youtube channel](https://www.youtube.com/@DaveGrayTeachesCode) with a little bit modifications.
Below are the links.

- [React Persistent User Login Authentication with JWT Tokens](https://www.youtube.com/watch?v=27KeYk-5vJw&t=287s&ab_channel=DaveGray)
- [Refresh Token Rotation and Reuse Detection in Node.js JWT Authentication
  ](https://www.youtube.com/watch?v=s-4k5TcGKHg&t=44s&ab_channel=DaveGray)

<!-- GETTING STARTED -->

### Installation

##### frontend

0. change directory to `./frontend` at first

1. install node modules via npm install

```
npm install
```

2. put a .env file in /frontend/.env, and add an env variable that indicate backend url, for example:

```
REACT_APP_BACKEND_URL=http://localhost:3500
```

##### backend

0. change directory to `./backend` at first

1. Register MongoDB cloud service at [here](https://cloud.mongodb.com/v2/62c706b405ec573b7bbafe3d#/metrics/replicaSet/63c996c3e7d9ea0bdcf6e740/explorer/auth/users/find), and create a new clouster if you do not have one, and remember the connection string given by Mongo which should be put in `.env` file

2. install node modules via npm install

```
npm install
```

2. put a `.env` file in `./backend/.env`, and add following env variables:

```
MONGODB_ACCOUNT=@YourAccount
MONGODB_PASSWORD=@YourPassword
MONGODB_URI=mongodb+srv://${MONGODB_ACCOUNT}:${MONGODB_PASSWORD}@@YourClouster.dnxa0.mongodb.net/@YourDB?retryWrites=true&w=majority

ACCESS_TOKEN_SECRET=@Base64EncodedString # example: c9fba6f2d542b3e30ae2426decdc54d06fc2c1742a0017acccb2693ad637d75546461931863eb02f23b9e94992f62b6a6f30e1b1305d330464d913114f3f284d
REFRESH_TOKEN_SECRET=@Base64EncodedString # example: c9fba6f2d542b3e30ae2426decdc54d06fc2c1742a0017acccb2693ad637d75546461931863eb02f23b9e94992f62b6a6f30e1b1305d330464d913114f3f284d
```

The base64 encoded string can be generated by node lib `crypto`, enter node bash and run following script to get base64 encoded string shown in terminal.

```
require('crypto').randomBytes(64).toString('hex')
```

### Start the project

##### frontend

Start with dev mode

```
npm run start
```

Build the production files

```
npm run build
```

##### backend

Start with dev mode

```
npm run dev
```

Start with production mode

```
npm run start
```

<!-- Documentation -->

## Documentation

For the detail process flow of refresh token & access token authentication, please refer to uml/\*.plantuml, but please ensure the plantuml plugin has been installed.

<!-- ROADMAP -->
